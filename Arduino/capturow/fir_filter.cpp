#include "fir_filter.h"

static double filter_taps[LPFFILTER_TAP_NUM] = {
  -0.005260790572292169,
  -0.0007036895130249605,
  -0.000746433004004237,
  -0.0007878535381839818,
  -0.0008275740592679291,
  -0.0008652220657837725,
  -0.000900437835825751,
  -0.0009330961609516818,
  -0.0009624280187455519,
  -0.0009886676393594796,
  -0.001010460191555868,
  -0.0010281852421028489,
  -0.0010413421957351284,
  -0.0010490730064642135,
  -0.0010511582706994314,
  -0.0010473848251348144,
  -0.001037406761773402,
  -0.0010205726582152258,
  -0.0009964704003492012,
  -0.000964683106193767,
  -0.0009249087182150134,
  -0.0008767210922965599,
  -0.0008195134127841717,
  -0.0007532290840190142,
  -0.0006777347306669193,
  -0.0005923942237905107,
  -0.0004969037316681465,
  -0.00039073651500146745,
  -0.0002740652516957873,
  -0.00014685026317257823,
  -0.00000864759449408245,
  0.00014147116304161965,
  0.00030326188456337896,
  0.00047526626641939025,
  0.0006605620994507252,
  0.0008568696131336745,
  0.0010653897138451216,
  0.0012856999366422832,
  0.0015179177562591772,
  0.0017620647523331797,
  0.0020175883198364454,
  0.002286182934296881,
  0.0025627833450666063,
  0.0028543364583028747,
  0.0031556544453747886,
  0.0034663687158629354,
  0.0037875780119355253,
  0.004119311689586638,
  0.0044607929936795925,
  0.0048108936028597275,
  0.005169321647433167,
  0.005535509949759285,
  0.005909587581503814,
  0.006290915192326845,
  0.0066787424124400505,
  0.007072667148346545,
  0.007471892389134433,
  0.007875483410215904,
  0.008282560599096447,
  0.008692374626119968,
  0.009104266284514951,
  0.009517366070443466,
  0.009930747859078756,
  0.010343587449888197,
  0.010755589657094451,
  0.011166069300682473,
  0.011573944171481455,
  0.011979013527081278,
  0.012379767407862455,
  0.012775044342114012,
  0.013162875722365614,
  0.01354191152625031,
  0.013912332124876931,
  0.01427717948527958,
  0.01464036588620227,
  0.014976342810529116,
  0.015312557609970651,
  0.0156336757105654,
  0.01594227927343134,
  0.016237345028115205,
  0.016518172505346995,
  0.01678430263866983,
  0.01703467574446222,
  0.01726960743519103,
  0.01748704409054851,
  0.017688035030653762,
  0.017871553719994156,
  0.018036621509481172,
  0.018183204180753653,
  0.018311143794633666,
  0.018420085011581003,
  0.018509433721772137,
  0.018579126249263122,
  0.01862900609353577,
  0.018659126612664317,
  0.01866927180088893,
  0.018659126612664317,
  0.01862900609353577,
  0.018579126249263122,
  0.018509433721772137,
  0.018420085011581003,
  0.018311143794633666,
  0.018183204180753653,
  0.018036621509481172,
  0.017871553719994156,
  0.017688035030653762,
  0.01748704409054851,
  0.01726960743519103,
  0.01703467574446222,
  0.01678430263866983,
  0.016518172505346995,
  0.016237345028115205,
  0.01594227927343134,
  0.0156336757105654,
  0.015312557609970651,
  0.014976342810529116,
  0.01464036588620227,
  0.01427717948527958,
  0.013912332124876931,
  0.01354191152625031,
  0.013162875722365614,
  0.012775044342114012,
  0.012379767407862455,
  0.011979013527081278,
  0.011573944171481455,
  0.011166069300682473,
  0.010755589657094451,
  0.010343587449888197,
  0.009930747859078756,
  0.009517366070443466,
  0.009104266284514951,
  0.008692374626119968,
  0.008282560599096447,
  0.007875483410215904,
  0.007471892389134433,
  0.007072667148346545,
  0.0066787424124400505,
  0.006290915192326845,
  0.005909587581503814,
  0.005535509949759285,
  0.005169321647433167,
  0.0048108936028597275,
  0.0044607929936795925,
  0.004119311689586638,
  0.0037875780119355253,
  0.0034663687158629354,
  0.0031556544453747886,
  0.0028543364583028747,
  0.0025627833450666063,
  0.002286182934296881,
  0.0020175883198364454,
  0.0017620647523331797,
  0.0015179177562591772,
  0.0012856999366422832,
  0.0010653897138451216,
  0.0008568696131336745,
  0.0006605620994507252,
  0.00047526626641939025,
  0.00030326188456337896,
  0.00014147116304161965,
  -0.00000864759449408245,
  -0.00014685026317257823,
  -0.0002740652516957873,
  -0.00039073651500146745,
  -0.0004969037316681465,
  -0.0005923942237905107,
  -0.0006777347306669193,
  -0.0007532290840190142,
  -0.0008195134127841717,
  -0.0008767210922965599,
  -0.0009249087182150134,
  -0.000964683106193767,
  -0.0009964704003492012,
  -0.0010205726582152258,
  -0.001037406761773402,
  -0.0010473848251348144,
  -0.0010511582706994314,
  -0.0010490730064642135,
  -0.0010413421957351284,
  -0.0010281852421028489,
  -0.001010460191555868,
  -0.0009886676393594796,
  -0.0009624280187455519,
  -0.0009330961609516818,
  -0.000900437835825751,
  -0.0008652220657837725,
  -0.0008275740592679291,
  -0.0007878535381839818,
  -0.000746433004004237,
  -0.0007036895130249605,
  -0.005260790572292169
};

void lpfFilter_init(lpfFilter* f) {
  int i;
  for(i = 0; i < LPFFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void lpfFilter_put(lpfFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LPFFILTER_TAP_NUM)
    f->last_index = 0;
}

double lpfFilter_get(lpfFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LPFFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LPFFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
